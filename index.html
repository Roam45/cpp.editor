from flask import Flask, request, send_file
import os
import subprocess

app = Flask(__name__)

@app.route("/compile", methods=["POST"])
def compile_code():
    data = request.json
    code = data.get("code")
    if not code:
        return "No code provided", 400

    # Save the code to a temporary .cpp file
    code_file = "temp_code.cpp"
    exe_file = "program.exe"
    with open(code_file, "w") as f:
        f.write(code)

    # Compile the code using g++
    try:
        result = subprocess.run(
            ["g++", code_file, "-o", exe_file],
            stdout=subprocess.PIPE,
            stderr=subprocess.PIPE,
            text=True
        )
        if result.returncode != 0:
            return f"Compilation error: {result.stderr}", 400
    except Exception as e:
        return f"Error during compilation: {str(e)}", 500

    # Send back the compiled .exe file
    return send_file(exe_file, as_attachment=True)

if __name__ == "__main__":
    app.run(debug=True)
